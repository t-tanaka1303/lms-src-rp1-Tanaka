<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/common/layout :: layout(~{::title},~{::body/content()})}">
<head>
<meta charset="UTF-8">
<title>勤怠情報変更｜LMS</title>
</head>
<body>

<!-- 完了メッセージ -->
<th:block th:if="${not #strings.isEmpty(message)}">
    <div class="alert alert-info alert-dismissible fade in" role="alert">
        <button type="button" class="close" data-dismiss="alert">
            <span>×</span>
        </button>
        <span>[[${message}]]</span>
    </div>
</th:block>

<!-- エラーメッセージ -->
<th:block th:if="${not #strings.isEmpty(error)}">
    <ul style="padding-left: 0; list-style: none;">
        <li>
            <span th:text="'* ' + ${error}" class="help-inline error"></span>
        </li>
    </ul>
</th:block>

<h2>勤怠管理</h2>

<th:block th:if="${session.loginUserDto.role == '0001'}">
    <div class="well well-lg p10 mb10">
        <div class="form-group">
            <small id="now"></small>
        </div>
        <div class="form-group">
            <form th:action="@{/attendance/detail}" method="post" class="form-inline">
                <input type="submit" value="出勤" name="punchIn" class="btn btn-default" />
                <input type="submit" value="退勤" name="punchOut" class="btn btn-default" />
            </form>
        </div>
        <p><a th:href="@{/attendance/update}">勤怠情報を直接編集する</a></p>
    </div>
</th:block>

<div class="row">
    <div class="bs-component col-sm-12">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>日付</th>
                    <th>コース内容</th>
                    <th>出勤</th>
                    <th>退勤</th>
                    <th>中抜け時間</th>
                    <th>ステータス</th>
                    <th>備考</th>
                </tr>
            </thead>
            <tbody>
                <th:block th:each="dto : ${attendanceManagementDtoList}" th:object="${dto}">
                    <tr>
                        <td>[[*{#dates.format(trainingDate,'yyyy年M月d日(E)')}]]</td>
                        <td>[[*{sectionName}]]</td>
                        <td>[[*{trainingStartTime}]]</td>
                        <td>[[*{trainingEndTime}]]</td>
                        <td>[[*{blankTimeValue}]]</td>
                        <td>[[*{statusDispName}]]</td>
                        <td>[[*{note}]]</td>
                    </tr>
                </th:block>
            </tbody>
        </table>
    </div>
</div>

<!-- Task25：過去日未入力ダイアログ -->
<script th:inline="javascript">
/*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function () {
        try {
            var hasWarning = /*[[${warning}]]*/ false;
            if (hasWarning) {
                alert('過去日の勤怠に未入力があります。');
            }
        } catch(e) {
            console.error('警告ダイアログ処理でエラー:', e);
        }

        // 現在時刻表示
        var nowElem = document.getElementById('now');
        if (nowElem) {
            var d = new Date();
            nowElem.innerText = '現在の時刻は ' +
                ('0' + d.getHours()).slice(-2) + ':' +
                ('0' + d.getMinutes()).slice(-2) + ' です。';
        }
    });
/*]]>*/
</script>

</body>
</html>
